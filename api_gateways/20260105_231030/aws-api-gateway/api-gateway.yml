{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "SigmaLangApi": {
      "Type": "AWS::ApiGateway::RestApi",
      "Properties": {
        "Name": "SigmaLangAPI",
        "Description": "SigmaLang Semantic Compression API",
        "EndpointConfiguration": {
          "Types": [
            "REGIONAL"
          ]
        }
      }
    },
    "CompressResource": {
      "Type": "AWS::ApiGateway::Resource",
      "Properties": {
        "RestApiId": {
          "Ref": "SigmaLangApi"
        },
        "ParentId": {
          "Fn::GetAtt": [
            "SigmaLangApi",
            "RootResourceId"
          ]
        },
        "PathPart": "compress"
      }
    },
    "CompressMethod": {
      "Type": "AWS::ApiGateway::Method",
      "Properties": {
        "RestApiId": {
          "Ref": "SigmaLangApi"
        },
        "ResourceId": {
          "Ref": "CompressResource"
        },
        "HttpMethod": "POST",
        "AuthorizationType": "NONE",
        "Integration": {
          "Type": "HTTP",
          "IntegrationHttpMethod": "POST",
          "Uri": "http://sigmalang-backend:8000/compress",
          "PassthroughBehavior": "WHEN_NO_TEMPLATES"
        }
      }
    },
    "ApiDeployment": {
      "Type": "AWS::ApiGateway::Deployment",
      "DependsOn": "CompressMethod",
      "Properties": {
        "RestApiId": {
          "Ref": "SigmaLangApi"
        },
        "StageName": "prod"
      }
    }
  },
  "Outputs": {
    "ApiUrl": {
      "Description": "API Gateway URL",
      "Value": {
        "Fn::Sub": "https://${SigmaLangApi}.execute-api.${AWS::Region}.amazonaws.com/prod"
      }
    }
  }
}